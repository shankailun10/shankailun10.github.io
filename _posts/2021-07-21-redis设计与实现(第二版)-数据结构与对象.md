# redis数据结构与对象
1. TOC
{:toc}
## 简单动态字符串（simple dynamic string, SDS）
### 1、用途
保存redis数据库的字符串值，和作为缓冲区使用(AOF模块的AOF缓冲区，和客户端状态的输入缓冲区)
### 2、定义
SDS 用 sds.h/sdshdr 结构体表示

    # SDS 结构体
    struct sdshdr {
        // 记录 buf 数组中已使用字节的数量, 等于 SDS 所保存字符串的长度
        int len;
        // 记录 buf 数组中未使用字节的数量
        int free;
        // 字节数组，用于保存字符串
        char buf[];
    };
### 3、API

1. sdsnew 创建一个sds, o(n)，n为sds字符串长度
2. sdsempty 创建一个空的sds, o(1)
3. ...

### 4、SDS 与 C 字符串的区别
#### 4.1 常数复杂度获取字符串长度
c 字符串使用 n+1 长度的字符数组表示长度为 n 的字符串，最后一位是空字符'\0'，c 字符串不记录字符串的长度，获取c 字符串长度时间复杂度 o(n)，SDS 结构中记录字符串的长度，获取长度时间复杂度o(1)。
#### 4.2 杜绝缓冲区溢出
c 字符串由于不记录长度，容易导致缓冲区溢出(buffer overflow)，如使用string.h/strcat(char* dest, const char* str)进行字符串拼接时，没有为dest分配足够的空间容纳str，导致拼接后str覆盖掉dest后面空间的内容，产生问题。SDK 中strcat()函数在执行时会先判断dest空间是否足够，不够时先进行扩展再进行拼接。




